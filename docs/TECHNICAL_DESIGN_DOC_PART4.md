# ðŸ“‹ æŠ€è¡“è¨­è¨ˆæ–‡ä»¶ (TDD) - Part 4: å•†æˆ¶ç«¯è©³ç´°è¦æ ¼ (Merchant Portal Deep Dive)

> **æ–‡ä»¶ç‹€æ…‹**: Draft
> **æ’°å¯«æ—¥æœŸ**: 2026-01-23
> **å°ˆæ¡ˆç‰ˆæœ¬**: 0.0.1 (Phase 10.9 Completed)
> **å°æ‡‰æª”æ¡ˆ**: `TECHNICAL_DESIGN_DOC_PART3.md` (ç¸½æŽ§è¦æ ¼ç¯‡)

---

## 1. å•†æˆ¶å„€è¡¨æ¿ / æˆ°æƒ…ä¸­å¿ƒ (Dashboard)

**è·¯å¾‘**: `src/views/Merchant/Dashboard/Index.vue`
**ç›®çš„**: æä¾›å•†æˆ¶ç‡Ÿé‹å¿«ç…§ï¼Œå”åŠ©æ±ºç­–èˆ‡é¢¨éšªç®¡ç†ã€‚

### 1.1 é—œéµç¸¾æ•ˆæŒ‡æ¨™ (KPIs)

| KPI åç¨± | å®šç¾©èˆ‡è¨ˆç®—æ–¹å¼ | æ¯”è¼ƒåŸºæº– | UI å‘ˆç¾ |
| :--- | :--- | :--- | :--- |
| **Total Bet** | æœ¬æ—¥ 00:00 è‡³ä»Šçš„ç¸½æŠ•æ³¨é¡ã€‚ | æ˜¨æ—¥åŒæœŸ | ç¶ è‰²/ç´…è‰²ç®­é ­é¡¯ç¤ºå¢žé•·çŽ‡ (e.g. `+12.5%`)ã€‚ |
| **Net Win** | `Total Payout` - `Total Bet`ã€‚**æ­£æ•¸ä»£è¡¨çŽ©å®¶è´ (èŽŠå®¶è¼¸)ï¼Œè² æ•¸ä»£è¡¨çŽ©å®¶è¼¸ (èŽŠå®¶è´)**ã€‚ | æ˜¨æ—¥åŒæœŸ | **ç‰¹æ®Šè‘—è‰²**: æ­£æ•¸é¡¯ç¤ºç´…è‰² (è­¦ç¤º)ï¼Œè² æ•¸é¡¯ç¤ºç¶ è‰² (ç›ˆåˆ©)ã€‚ |
| **Active Players** | æœ¬æ—¥æœ‰ä¸‹æ³¨ç´€éŒ„çš„ä¸é‡è¤‡çŽ©å®¶ (Unique Users)ã€‚ | æ˜¨æ—¥åŒæœŸ | æ•¸å­—é¡¯ç¤ºã€‚ |
| **Tx Count** | æœ¬æ—¥æ³¨å–®ç¸½æ•¸ã€‚ | ç„¡ | æ•¸å­—é¡¯ç¤ºã€‚ |

### 1.2 ç‡Ÿæ”¶ç›£æŽ§ (Revenue Trend)

* **åœ–è¡¨é¡žåž‹**: é›™æŠ˜ç·šåœ– (ECharts)ã€‚
* **ç¶­åº¦**:
    1. **Bet Volume**: æŠ•æ³¨é‡ (è—ç·š)ã€‚
    2. **Net Win**: æ·¨æç›Š (ç¶ ç·š)ã€‚
* **æ™‚é–“è·¨åº¦**: å›ºå®šé¡¯ç¤ºä»Šæ—¥ + éŽåŽ» 6 æ—¥ (å…± 7 æ—¥)ã€‚

### 1.3 æ™ºæ…§è­¦å ±ç³»çµ± (Alerts)

* **Invoice Pending**: ç•¶ç³»çµ±åµæ¸¬åˆ°æœ‰ç‹€æ…‹ç‚º `pending` çš„å¸³å–®æ™‚ï¼Œé¡¯ç¤ºé»ƒè‰²è­¦å‘Šï¼šã€Œæ‚¨æœ‰å¾…ä»˜å¸³å–®ï¼Œè«‹ç›¡é€Ÿè™•ç†ã€ã€‚
* **Fund Rejected**: ç•¶æœ€è¿‘ä¸€ç­†è³‡é‡‘ç”³è«‹è¢«æ‹’çµ•æ™‚ï¼Œé¡¯ç¤ºç´…è‰²è­¦å‘Šï¼šã€Œæ‚¨çš„å……å€¼/èª¿é¡ç”³è«‹å·²è¢«æ‹’çµ•ã€ã€‚
* **å‹•ä½œ**: é»žæ“Š `Process` æŒ‰éˆ•å¯ç›´æŽ¥è·³è½‰è‡³å°æ‡‰çš„è²¡å‹™ç®¡ç†é é¢ã€‚

---

## 2. éŠæˆ²ç®¡ç† (My Games)

**è·¯å¾‘**: `src/views/Merchant/Game/MyGames.vue`
**ç›®çš„**: å•†æˆ¶è‡ªä¸»ç®¡ç†éŠæˆ²çš„ä¸Šæž¶èˆ‡é¡¯ç¤ºç‹€æ…‹ã€‚

### 2.1 é›™å±¤ç‹€æ…‹æŽ§ç®¡é‚è¼¯ (Enable Logic)

é€™æ˜¯æœ¬ç³»çµ±çš„æ ¸å¿ƒæ¬Šé™è¨­è¨ˆï¼Œç¢ºä¿å¹³å°æ“æœ‰æœ€é«˜æŽ§åˆ¶æ¬Šã€‚

1. **Platform Status (ç¸½æŽ§ç«¯æ¬Šé™)**:
    * `Active`: å…è¨±å•†æˆ¶é–‹å•Ÿã€‚
    * `Disabled/Maintenance`: å•†æˆ¶**ç„¡æ³•**é–‹å•Ÿ (Switch é¡¯ç¤º Disabled ç‹€æ…‹ï¼Œä¸¦æœ‰ Tooltip æç¤º "Disabled by Platform")ã€‚
2. **Merchant Status (å•†æˆ¶ç«¯æ¬Šé™)**:
    * åªæœ‰åœ¨ Platform Status = `Active` æ™‚ï¼Œå•†æˆ¶æ‰èƒ½è‡ªç”±åˆ‡æ› `Merchant Enabled`ã€‚

### 2.2 RTP æ¨™ç±¤é¡¯ç¤º

* **è³‡æ–™ä¾†æº**: å¾ž API å–å¾— `rtp` æ¬„ä½ (e.g., 96.5)ã€‚
* **é¡¯ç¤ºè¦å‰‡**: æ•¸å€¼ > 96% é¡¯ç¤ºç¶ è‰²é«˜äº®ï¼Œä¾¿æ–¼å•†æˆ¶è­˜åˆ¥é«˜å›žå ±çŽ‡éŠæˆ²ã€‚

### 2.3 æ‰¹é‡æ“ä½œ (Batch Actions)

* **è§¸ç™¼æ¢ä»¶**: å‹¾é¸è¡¨æ ¼å·¦å´çš„ Checkboxã€‚
* **åŠŸèƒ½**:
  * `Enable Selected`: æ‰¹é‡ä¸Šæž¶ (è‡ªå‹•è·³éŽ Platform Disabled çš„é …ç›®)ã€‚
  * `Disable Selected`: æ‰¹é‡ä¸‹æž¶ã€‚
  * **Optimistic Update**: å‰ç«¯å…ˆè¡Œæ›´æ–° UI ç‹€æ…‹ï¼Œè‹¥ API å›žå‚³å¤±æ•—å‰‡è‡ªå‹•å›žæ»¾ï¼Œæä¾›æµæš¢é«”é©—ã€‚

---

## 3. ä»£ç†ç®¡ç†ç³»çµ± (Agent System)

**è·¯å¾‘**: `src/views/Merchant/Organization/SubAgentList.vue`
**ç›®çš„**: ç™¼å±•å¤šå±¤ç´š (Multi-level) ä»£ç†ç¶²è·¯ï¼Œæ“´å¤§æ¥­å‹™è§¸åŠã€‚

### 3.1 ä»£ç†å‰µå»ºæµç¨‹

**å…ƒä»¶**: `SubAgentList.vue` (Modal)

1. **Account / Password**: è¨­å®šä»£ç†ç™»å…¥å¸³è™Ÿå¯†ç¢¼ã€‚
2. **Commission Rate (%)**:
    * **å®šç¾©**: è©²ä»£ç†å¯ç²å¾—çš„åˆ©æ½¤åˆ†æˆã€‚
    * **é™åˆ¶**: **ä¸å¯é«˜æ–¼** ä¸Šç´šå•†æˆ¶è‡ªèº«çš„ `Revenue Share` (e.g., å•†æˆ¶æ‹¿ 90%ï¼Œä»£ç†æœ€å¤šè¨­ 90%ï¼Œé€šå¸¸è¨­ 30-50%)ã€‚
3. **Status**: é è¨­ Activeã€‚

### 3.2 é¡åº¦åŠƒè½‰ (Transfer)

* **é¡žåž‹**:
  * **Deposit (å­˜æ¬¾)**: å¾žå•†æˆ¶éŒ¢åŒ… -> ä»£ç†éŒ¢åŒ…ã€‚
  * **Withdraw (ææ¬¾)**: å¾žä»£ç†éŒ¢åŒ… -> å•†æˆ¶éŒ¢åŒ… (éœ€ä»£ç†åŒæ„æˆ–å¼·è¡ŒåŠƒè½‰ï¼Œç›®å‰å¯¦ä½œé è¨­ç‚ºå¼·è¡Œ)ã€‚
* **é˜²å‘†**: è½‰å¸³é‡‘é¡å¿…é ˆ > 0 ä¸” <= ä¾†æºéŒ¢åŒ…é¤˜é¡ã€‚

### 3.3 æŽ¨å»£æ©Ÿåˆ¶ (Promotion)

* æ¯ä½ä»£ç†æ“æœ‰ç¨ç«‹çš„ `Promotion Code` (e.g., `REF123`)ã€‚
* **Link Generator**: ç³»çµ±è‡ªå‹•ç”Ÿæˆ `https://platform.com/r/{code}` é€£çµï¼Œé»žæ“ŠæŒ‰éˆ•ä¸€éµè¤‡è£½ã€‚

---

## 4. è²¡å‹™èˆ‡å ±è¡¨ä¸­å¿ƒ (Finance & Reports)

### 4.1 è³‡é‡‘ç®¡ç† (Fund Management)

**è·¯å¾‘**: `src/views/Merchant/Finance/FundManagement.vue`

* **é ‚éƒ¨è³‡è¨Šå¡**:
  * **Balance**: ç›®å‰å¯ç”¨é¤˜é¡ (Seamless æ¨¡å¼å‰‡é¡¯ç¤º 0 æˆ–éš±è—)ã€‚
  * **Credit Limit**: ä¿¡ç”¨é¡åº¦ã€‚
* **é›™å‘æºé€šæ©Ÿåˆ¶**:
  * ç•¶ç”³è«‹ç‹€æ…‹ç‚º `Rejected` æˆ–é¡žåž‹ç‚º `Manual Adjust` æ™‚ï¼Œæœƒåœ¨å‚™è¨»æ¬„é¡¯ç¤º `Admin Note` (ç´…è‰² Tag)ï¼Œè®“å•†æˆ¶æ¸…æ¥šçŸ¥é“è¢«æ‹’çµ•åŽŸå› æˆ–èª¿å¸³ç†ç”±ã€‚

### 4.2 æ¯æ—¥ç‡Ÿæ”¶å ±è¡¨ (Revenue Report)

**è·¯å¾‘**: `src/views/Merchant/Reports/RevenueReport.vue`

* **è³‡æ–™çµæ§‹**: Hierarchical Data (å±¤ç´šè³‡æ–™)ã€‚
  * **Level 1**: æ—¥æœŸ (YYYY-MM-DD)ã€‚
  * **Level 2**: é»žæ“Šå±•é–‹ (Drill-down)ï¼Œé¡¯ç¤ºè©²æ—¥å„ä¾›æ‡‰å•† (PG, Evo) çš„è²¢ç»ä½”æ¯”ã€‚
* **çµ±è¨ˆæ¬„ä½**:
  * Tx Count (æ³¨å–®æ•¸)
  * Total Bet (ç¸½æµæ°´)
  * Total Payout (ç¸½æ´¾å½©)
  * **Net Win (æ·¨åˆ©)**: æ”¯æ´æ­£è² æ•¸è‘—è‰² (ç¶ /ç´…)ã€‚

### 4.3 æ³¨å–®æŸ¥è©¢ (Bet Query)

**è·¯å¾‘**: `src/views/Merchant/Reports/BetQuery.vue`

* **ç¯©é¸ç¶­åº¦**:
    1. **Date Range**: æ™‚é–“ç¯„åœã€‚
    2. **Round ID**: ç”¨æ–¼å®¢æœæŸ¥è©¢ç‰¹å®šå±€è™Ÿã€‚
    3. **Player ID**: æŸ¥è©¢ç‰¹å®šçŽ©å®¶çš„æŠ•æ³¨ç´€éŒ„ã€‚
* **è©³ç´°è³‡è¨Š (JSON Viewer)**:
  * é»žæ“Š `ðŸ”` æŒ‰éˆ•é–‹å•Ÿ Drawerï¼Œä»¥ JSON æ ¼å¼å®Œæ•´å‘ˆç¾åŽŸå§‹æ³¨å–®å…§å®¹ (`detail` æ¬„ä½)ï¼ŒåŒ…å«ç‰Œåž‹ã€ä¸­çŽé€£ç·šèˆ‡çŸ©é™£è³‡è¨Šï¼Œä¾¿æ–¼çˆ­è­°ä»²è£ã€‚
